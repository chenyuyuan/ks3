<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>
	<link rel="stylesheet" href="http://apps.bdimg.com/libs/bootstrap/3.3.0/css/bootstrap.min.css">
	<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>
	<script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
	
	<style>
		textarea:focus{
			outline: 0;
		}
		.btn:focus,.btn:active:focus,.btn.active:focus,.btn.focus,.btn:active.focus,.btn.active.focus {
			outline: none;
			border-color: transparent;
			box-shadow:none;
		}
		.shadow{
			-webkit-box-shadow: 0 1px 5px 0 rgba(0,34,77,.12);
			-moz-box-shadow: 0 1px 5px 0 rgba(0,34,77,.12);
			box-shadow: 0 1px 5px 0 rgba(0,34,77,.12);
		}
		.shadow-smaller{
			-webkit-box-shadow: 0 1px 5px 0 rgba(0,34,77,.07);
			-moz-box-shadow: 0 1px 5px 0 rgba(0,34,77,.07);
			box-shadow: 0 1px 5px 0 rgba(0,34,77,.07);
		}
	
	</style>
</head>
<body style="background-color: #fafafa">

<div class="container-fluid">
	<div class="row clearfix">
		<ul class="nav nav-pills shadow" style="height:50px;background-color: #ffffff;margin-right: 0px;margin-left: 0px">
			<li class="active">
				<a href="http://127.0.0.1:8080/home" style="padding: 0 12px 0 12px;font-size: 28px">R</a>
			</li>
			<li>
				<a style="font-size:16px; margin-top:2px" href="http://127.0.0.1:8080/home">首页</a>
			</li>
			
			<li>
				<a class="text-muted" style="font-size:16px; margin-top:2px" href="http://127.0.0.1:8080/topicSquare">话题</a>
			</li>
			<li style="margin-left: 60px;margin-top: 8px">
				<div class="input-group" style="width:342px">
					<input type="text"  onclick="window.location.href='http://127.0.0.1:3000/search'" class="form-control">
					<span class="input-group-addon" style="background-color: #6db0ff;color:white;" onclick="window.location.href='http://127.0.0.1:8080/search'">搜索</span>
				</div>
			</li>
			<li class="dropdown pull-right" style="margin-top: 10px;margin-right: 8px">
				<span class="text-muted" name="{{myid}}" style="font-size:16px;margin-right:18px;" onclick="window.location.href='http://127.0.0.1:8080/people/'+$(this).attr('name')+'/msg'">消息</span>
				<span class="text-muted" name="{{myid}}" style="font-size:16px;margin-right:18px;" onclick="window.location.href='http://127.0.0.1:8080/people/'+$(this).attr('name')+'/msg'">我的</span>
				<ul class="dropdown-menu">
					<li>
						<a href="http://127.0.0.1:8080/people/me/myask">个人主页</a>
					</li>
					<li class="divider">
					</li>
					<li>
						<a href="http://127.0.0.1:3000/logout">退出登录</a>
					</li>
				</ul>
			</li>
		</ul>
	</div>
	
	<div class="col-md-12 column" style="margin-top: 50px">
		<div class="row clearfix">
			<div class="col-md-1 column">
			</div>
			<div class="col-md-7 column" style="padding:0;margin: 2px">
				<div class="shadow-smaller card-essay" style="background-color: white;margin-left: 10px;margin-right:-10px;padding:15px;border:#CCCCCC;border-width:1px;border-top-right-radius:4px; border-top-left-radius:4px; border-bottom-left-radius:4px; border-bottom-right-radius:4px;border-style:solid ">
				
				</div>
				<br/>
			</div>
			<div class="col-md-3 column" style=";padding: 0;margin: 2px;margin-left: 12px">
			
			</div>
			<div class="col-md-1 column">
			</div>
		</div>
		<hr style="margin: 20px;">
		<div class="row clearfix">
			<div class="col-md-2 column">
			</div>
			<div class="col-md-5 column">
				<address> <strong>hit.</strong><br /> 795 Folsom Ave, Suite 600<br /> San Francisco, CA 94107<br /> <abbr title="Phone">P:</abbr> (123) 456-7890</address>
			</div>
			<div class="col-md-3 column">
			</div>
			<div class="col-md-2 column">
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" charset="UTF-8">
    function ParentTree() {this.nodes = [];}function ParentTreeNode(data, parent) {this.data = data || null;this.parent = parent || 0;}
    $(document).ready(function () {
        //回答点赞
        $(".anslike").click(function () {
            a=$(this).attr("name");
            console.log(a);
            flag=a[0]
            answerid=''
            for(var key in a){
                if(key>1){
                    answerid=answerid+a[key]
                }
            }
            data={
                "flag":flag,
                "ansid":answerid
            }
            $.ajax({
                url:"http://127.0.0.1:3000/answer/like",
                type:"POST",
                dataType:"json",
                data:JSON.stringify(data),
                contentType:"application/json; charset=UTF-8",
                success:function (data) {
                    if(data.msg=="liked")  {
                        // alert("liked")
                        window.location.reload()
                    }
                    else if(data.msg=="canceled"){
                        // alert("canceled")
                        window.location.reload()
                    }
                },
            })
        })
        //收藏回答
        $(".answerstar").click(function () {
            a=$(this).attr("name");
            flag=a[0]
            answerid=''
            for(var key in a){
                if(key>1){
                    answerid=answerid+a[key]
                }
            }
            console.log(answerid);
            data={
                "flag":flag,
                "ansid":answerid
            }
            $.ajax({
                url:"http://127.0.0.1:3000/answer/star",
                type:"POST",
                dataType:"json",
                data:JSON.stringify(data),
                contentType:"application/json; charset=UTF-8",
                success:function (data) {
                    if(data.msg=="stared")  {
                        // alert("stared")
                        window.location.reload()
                    }
                    else if(data.msg=="canceled"){
                        // alert("canceled")
                        window.location.reload()
                    }
                },
            })
        })
        //支持
        $(".supportit").click(function () {
            a=$(this).attr("name")
            flag=a[0]
            temptopicid=''
            for (var key in a){
                if (key>1){
                    temptopicid=temptopicid+a[key]
                }
            }
            data={
                "flag":flag,
                "temptopicid":temptopicid
            }
            $.ajax({
                type:'POST',
                url:'http://127.0.0.1:3000/home/supporting',
                contentType: 'application/json; charset=UTF-8',
                data:JSON.stringify(data),
                dataType:'json',
                success:function (data) {
                    if(data.msg=="finished"){
                        alert("话题创建成功")
                        window.location.reload()
                    }
                    if (data.msg=="supported"){
                        window.location.reload()
                    }
                    else if(data.msg=="canceled"){
                        window.location.reload()
                    }
                }
            })
        })
        //显示申请话题进度
        $('.probar').click(function () {
            process=$(this).attr('name')
            $(this).css('width',process+'0%')
            if(process<=2){
                $(this).addClass("progress-bar-danger ")
            }
            else if(process<=5){
                $(this).addClass("progress-bar-warning")
            }
            else if(process<=7){
                $(this).addClass("progress-bar-info")
            }
            else if(process<=10){
                $(this).addClass("progress-bar-success")
            }
        })
        $('.probar').click()
        $('#share').click(function () {
            alert("111111");
            var v="ppp";
            window.clipboardData.setData("text",v);
        });
        //申请话题
        $("#submitinfo").click(function () {
            topic=$("#topic").val()
            topicintro=$("#topicintro").val()
            tips=$("#tips")
            if (topic==""||topicintro==""){
                tips.html("请输入")
            }
            else {
                tips.html("")
                data={
                    "topic":topic,
                    "topicintro":topicintro
                }
                $.ajax({
                    type:'POST',
                    url:'http://127.0.0.1:3000/home/applyingtopic',
                    contentType: 'application/json; charset=UTF-8',
                    data:JSON.stringify(data),
                    dataType:'json',
                    success:function (data) {
                        if (data.msg=="existed"){
                            tips.html("该话题已存在")
                        }
                        else if(data.msg=="good"){
                            tips.html("申请成功")
                            window.location.reload()
                        }
                    }
                })
            }
        })
        //回答问题
        $('#toanswer').click(function () {
            if($('#answering').css('display')=='none'){
                $('#answering').css('display','');
            }
        })
        var data={
            'questionid':'1'
        }
        $('#submitanswer').click(function () {
            $.ajax({
                type:'POST',
                url:'http://127.0.0.1:3000/submit/answering',
                contentType: 'application/json; charset=UTF-8',
                data:JSON.stringify(data),
                dataType:'json',
                success:function (data) {
                    alert("good")
                    alert(data.msg)
                }
            })
        })
        $(".comment").on("click",function () {
            var kingdom=$(this).parent().next().next();
            var pt = new ParentTree();
            ansid=$(this).attr("name")//得到点击的回答id
            //alert(ansid)
            if(kingdom.attr("name")=="0"){
                kingdom.attr("name","1")
                //kingdom.css("display","")
                var data={
                    "ansid":ansid
                }
                $.ajax({
                    url:'http://127.0.0.1:3000/comment/answer',
                    type:'POST',
                    contentType: 'application/json; charset=UTF-8',
                    dataType:'json',
                    data:JSON.stringify(data),
                    success:function (data) {
                        if(data.msg=='1'){

                            newdata=data.data;
                            //console.log(newdata)
                            for(var key in newdata){
                                for(var king in newdata){
                                    if(newdata[key].pid==-1){
                                        pt.nodes.push(new ParentTreeNode(newdata[key], -1));
                                        break;
                                    }
                                    else if(newdata[king].id==newdata[key].pid){
                                        pt.nodes.push(new ParentTreeNode(newdata[key], king));
                                        break;
                                    }
                                }
                            }
                            maxDepth=0;
                            data={
                                "ansid":ansid,

                            }
                            console.log("data.ansid:"+data.ansid)
                            //alert(ansid)

                            //console.log(pt.nodes[1].data)
                            for(var i=0;i<pt.nodes.length;i++){
                                depth=0;
                                for (var j=i; j!=-1;j=pt.nodes[j].parent){
                                    depth=depth+1;
                                }
                                if(depth>maxDepth)maxDepth=depth
                            }
                            commentinput="                        <div class=\"input-group\" style=\"margin-top: 10px;\">\n" +
                                "                            <input type=\"text\" class=\"form-control\">\n" +
                                "                            <span class=\"input-group-addon commentsubmit\" onclick='k=$(this); var a= $(this).prev().val();var b=$(this).parent().parent().attr(\"name\");datas={\"ansid\":ansid,\"content\":a,\"pid\":b};$.ajax({url:\"http://127.0.0.1:3000/comment/answer/submit\",type:\"POST\",data:JSON.stringify(datas),contentType:\"application/json; charset=UTF-8\",dataType:\"json\",success:function (data) {if(data.data.msg==\"good\"){alert(\"回复成功\")}window.location.reload() },error:function(a,b,c) {console.log(a.status+\"::\"+a.readyState+\"::\"+b) }})' style=\"background-color: #6db0ff;color:white;width: 50px\">回复</span>\n" +
                                "                        </div>"
                            for(var i in pt.nodes){
                                if(pt.nodes[i].parent==-1){
                                    kingdom.append("<div class='parent' name=\""+i+"\" style=\"background-color: #fafafa;margin-top: 10px;border:1px solid #eeeeee;padding: 7px;border-top-right-radius:8px; border-top-left-radius:8px; border-bottom-left-radius:8px; border-bottom-right-radius:8px;\">\n" +
                                        "        <div name=\""+pt.nodes[i].data.id+"\">\n" +
                                        "            <img src=\"http://127.0.0.1:3000/static/userhead/"+pt.nodes[i].data.uid+".jpg\" style=\"width: 15px\">\n" +
                                        "            <span>"+pt.nodes[i].data.account+":</span>\n" +
                                        "            <span>"+pt.nodes[i].data.content+"</span>\n" +
                                        "            <img class='replyanscomment' name='0' src=\"http://127.0.0.1:3000/static/material/reply.jpg\" onclick='if($(this).attr(\"name\")==\"0\"){$(this).parent().append(commentinput);$(this).attr(\"name\",\"1\")}else{if($(this).next().next().next().css(\"display\")==\"none\"){$(this).next().next().next().css(\"display\",\"\")}else{$(this).next().next().next().css(\"display\",\"none\")}}' width=\"13px\" style='margin-left: 5px'>\n" +
                                        "            <img class='tipoffanscomment' src=\"http://127.0.0.1:3000/static/material/tipoff.png\" onclick='var  id=$(this).parent().attr(\"name\"); datas={\"anscomment\":id};$.ajax({url:\"http://127.0.0.1:3000/comment/answer/tipoff\",type:\"POST\",data:JSON.stringify(datas),contentType:\"application/json; charset=UTF-8\",dataType:\"json\",success:function(data) { if(data.msg==\"good\"){alert(\"已举报\")} },error:function(a,b,c) {console.log(a.status+\"::\"+a.readyState+\"::\"+b) }})' width=\"13px\" style='margin-left: 5px'>\n" +
                                        "            <span class=\"pull-right\">"+pt.nodes[i].data.time+"</span>" +
                                        "        </div>\n" +
                                        "    </div>")
                                    pt.nodes[i].parent=-2
                                }
                            }
                            for (var i=0;i<maxDepth+3;i++){
                                for (var p=0;p<pt.nodes.length;p++){
                                    kingdom.find("div[name='"+pt.nodes[p].parent+"'].parent").append("<div class='parent' name=\""+p+"\" style=\"background-color: #fafafa;margin-top: 10px;border:1px solid #eeeeee;padding: 7px;border-top-right-radius:8px; border-top-left-radius:8px; border-bottom-left-radius:8px; border-bottom-right-radius:8px;\">\n" +
                                        "        <div name=\""+pt.nodes[p].data.id+"\">\n" +
                                        "            <img src=\"http://127.0.0.1:3000/static/userhead/"+pt.nodes[p].data.uid+".jpg\" style=\"width: 15px\" style='margin-left: 5px'>\n" +
                                        "            <span>"+pt.nodes[p].data.account+":</span>\n" +
                                        "            <span>"+pt.nodes[p].data.content+"</span>\n" +
                                        "            <img class='replyanscomment' name='0' src=\"http://127.0.0.1:3000/static/material/reply.jpg\" onclick='if($(this).attr(\"name\")==\"0\"){$(this).parent().append(commentinput);$(this).attr(\"name\",\"1\")}else{if($(this).next().next().next().css(\"display\")==\"none\"){$(this).next().next().next().css(\"display\",\"\")}else{$(this).next().next().next().css(\"display\",\"none\")}}' style='margin-left: 5px'>\n" +
                                        "            <img class='tipoffanscomment' src=\"http://127.0.0.1:3000/static/material/tipoff.png\" onclick='var  id=$(this).parent().attr(\"name\"); datas={\"anscomment\":id};$.ajax({url:\"http://127.0.0.1:3000/comment/answer/tipoff\",type:\"POST\",data:JSON.stringify(datas),contentType:\"application/json; charset=UTF-8\",dataType:\"json\",success:function(data) { if(data.msg==\"good\"){alert(\"已举报\")} },error:function(a,b,c) {console.log(a.status+\"::\"+a.readyState+\"::\"+b) }})' width=\"13px\" style='margin-left: 5px'>\n" +
                                        "            <span class=\"pull-right\">"+pt.nodes[p].data.time+"</span>" +
                                        "        </div>\n" +
                                        "    </div>")
                                    pt.nodes[p].parent=-2
                                }
                            }
                        }
                        else{
                            console.log("This answer have no comments")
                        }

                    },
                    error:function (e) {alert(e.status)}
                })
            }
            else if(kingdom.css("display")=="none"&&kingdom.attr("name")=="1"){
                kingdom.css("display","");
            }
            else{
                kingdom.css("display","none");
            }
        })
        $('.replyanscomment').on("click",function () {
            $(this).append("<div class=\"input-group\" style=\"margin-top: 10px;\">\n" +
                "                            <input type=\"text\" class=\"form-control\">\n" +
                "                            <span class=\"input-group-addon\" style=\"background-color: #6db0ff;color:white;width: 50px\">发表</span>\n" +
                "                        </div>")
        })
    })

</script>
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
</body>
</html>

